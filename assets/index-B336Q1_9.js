import{g as e,p as a,M as t,a as l,r as s,s as o,N as n,V as r,b as i,O as u,G as c,P as d,c as v,d as m,e as f,x as p,Q as _,R as g,m as b,S as y,T as k,C as w,w as h,l as V,U as x,W as S,X as $,o as C,q as T,K as U,v as j,y as P,B as A,A as B,Y as L,F,Z as M,H as R,_ as D,$ as I,a0 as N,a1 as K,a2 as Y,a3 as q}from"./index-X2pssZTS.js";import{V as G,a as W,b as z}from"./VSelect-LIMe1IgN.js";import{r as E,s as H,t as O,c as Q,v as X,w as Z,x as J,y as ee,z as ae,A as te,d as le,B as se,C as oe,D as ne,h as re,E as ie,q as ue,g as ce,V as de,i as ve,k as me,l as fe,j as pe}from"./ssrBoot-BJN1Wy2u.js";import{V as _e}from"./VFileInput-DmSJGwz6.js";import"./en-DEkKOPRf.js";const ge=a({multiLine:Boolean,text:String,timer:[Boolean,String],timeout:{type:[Number,String],default:5e3},vertical:Boolean,...oe({location:"bottom"}),...se(),...le(),...te(),...b(),...g(ne({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","retainFocus","captureFocus","disableInitialFocus","scrim","scrollStrategy","stickToTarget","viewportMargin"])},"VSnackbar"),be=e()({name:"VSnackbar",props:ge(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:g}=a;const b=t(e,"modelValue"),{positionClasses:V}=E(e),{scopeId:x}=H(),{themeClasses:S}=l(e),{colorClasses:$,colorStyles:C,variantClasses:T}=O(e),{roundedClasses:U}=Q(e),j=function(e){const a=o(e());let t=-1;function l(){clearInterval(t)}return y(l),{clear:l,time:a,start:function(s){const o=s?getComputedStyle(s):{transitionDuration:.2},n=1e3*parseFloat(o.transitionDuration)||200;if(l(),a.value<=0)return;const r=performance.now();t=window.setInterval(()=>{const t=performance.now()-r+n;a.value=Math.max(e()-t,0),a.value<=0&&l()},n)},reset:function(){l(),k(()=>a.value=e())}}}(()=>Number(e.timeout)),P=s(),A=s(),B=o(!1),L=o(0),F=s(),M=n(r,void 0);i(()=>!!M,()=>{const e=w();h(()=>{F.value=e.mainStyles.value})}),u(b,D),u(()=>e.timeout,D),c(()=>{b.value&&D()});let R=-1;function D(){j.reset(),window.clearTimeout(R);const a=Number(e.timeout);if(!b.value||-1===a)return;const t=d(A.value);j.start(t),R=window.setTimeout(()=>{b.value=!1},a)}function I(){B.value=!0,j.reset(),window.clearTimeout(R)}function N(){B.value=!1,D()}function K(e){L.value=e.touches[0].clientY}function Y(e){Math.abs(L.value-e.changedTouches[0].clientY)>50&&(b.value=!1)}function q(){B.value&&N()}const G=v(()=>e.location.split(" ").reduce((e,a)=>(e[`v-snackbar--${a}`]=!0,e),{}));return m(()=>{const a=X.filterProps(e),t=!!(g.default||g.text||e.text);return f(X,_({ref:P,class:["v-snackbar",{"v-snackbar--active":b.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--timer":!!e.timer,"v-snackbar--vertical":e.vertical},G.value,V.value,e.class],style:[F.value,e.style]},a,{modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,contentProps:_({class:["v-snackbar__wrapper",S.value,$.value,U.value,T.value],style:[C.value],onPointerenter:I,onPointerleave:N},a.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0,onTouchstartPassive:K,onTouchend:Y,onAfterLeave:q},x),{default:()=>[Z(!1,"v-snackbar"),e.timer&&!B.value&&p("div",{key:"timer",class:"v-snackbar__timer"},[f(J,{ref:A,color:"string"==typeof e.timer?e.timer:"info",max:e.timeout,modelValue:j.time.value},null)]),t&&p("div",{key:"content",class:"v-snackbar__content",role:"status","aria-live":"polite"},[g.text?.()??e.text,g.default?.()]),g.actions&&f(ee,{defaults:{VBtn:{variant:"text",ripple:!1,slim:!0}}},{default:()=>[p("div",{class:"v-snackbar__actions"},[g.actions({isActive:b})])]})],activator:g.activator})}),ae({},P)}}),ye=V({__name:"LanguageSelector",setup(e){const a=[...x.keys()].map(e=>({key:e,name:x.get(e)??""})),t=s(!1),l=s(!1),o=s(""),n=s(5e3),r=s(!1),i=s(!1),c=s(S.global.locale.value);async function d(){try{await navigator.clipboard.writeText(o.value),r.value=!0}catch{n.value=-1,i.value=!0}}return u(c,async(e,a)=>{if(e!==a&&S.global.locale.value!==e){t.value=!0;try{await $(S,c.value)}catch(s){o.value=String(s),n.value=5e3,r.value=!1,i.value=!1,l.value=!0,c.value=a}t.value=!1}}),(e,s)=>(T(),C(F,null,[f(G,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),"item-title":"name","item-value":"key",items:U(a),loading:t.value},null,8,["modelValue","items","loading"]),f(be,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=e=>l.value=e),"multi-line":"",timeout:n.value},{actions:j(()=>[f(re,{color:"info",onClick:d},{default:j(()=>[r.value?(T(),B(ie,{key:0,icon:"mdi-check-bold"})):L("",!0),i.value?(T(),B(ie,{key:1,icon:"mdi-alert"})):L("",!0),P(" "+A(e.$t("action.copy")),1)]),_:1}),f(re,{color:"error",onClick:s[1]||(s[1]=e=>l.value=!1)},{default:j(()=>[P(A(e.$t("action.close")),1)]),_:1})]),default:j(()=>[P(A(e.$t("message.cannot_change_language"))+" "+A(o.value)+" ",1)]),_:1},8,["modelValue","timeout"])],64))}}),ke={class:"mt-12"},we=V({__name:"DatasourceSelector",setup(e){const{t:a}=S.global,t=n(ue),l=s(!1),o=s(!1),r=s(""),i=s(!1),u=s(()=>{}),c=M(),d=R(),v=s([]),m=s("");function _(e,s){l.value=!0;const o=(async()=>{if(e.is_err())return e.erase_type();const a=await K(e.unwrap(),r.value,s);return a.is_err()?a.erase_type():(d.build_runtime_database(a.unwrap()),c.push("/Main"),Y.ok(void 0))})();q(o,a("message.error.failed_opening_database"),t).finally(()=>{l.value=!1})}function g(){l.value=!0;const e=m.value.endsWith("/")?m.value:`${m.value}/`,s=[e,`https://${e}`].map(e=>URL.parse(e)).find(e=>null!==e);if(void 0===s)return t("error","message.error.invalid_url",""),void(l.value=!1);I((async()=>{const e=URL.parse("data.json",s),l=await fetch(e);if(!l.ok)return void t("error",a("message.error.failed_to_fetch_data",{source:e.toString()}),`${l.status}: ${l.statusText}`);const n=await l.text();u.value=()=>{_(N(n),async e=>{const t=URL.parse(e,s);if(null===t)return Y.error(a("message.error.invalid_url"));try{const e=await fetch(t);return e.ok?Y.ok(await e.blob()):Y.error(a("message.error.failed_to_fetch_data",{source:t.href}),e.statusText)}catch(l){return Y.error(a("message.error.failed_to_fetch_data",{source:t.href}),String(l))}})},o.value=!0})(),a("message.error.failed_loading_database"),t).then(()=>{l.value=!1})}function b(e){if(void 0===e)return;l.value=!0;const s=Array.isArray(e)?[...e]:[e];v.value.length=0,I((async()=>{const e=s.filter(e=>2===e.webkitRelativePath.split("/").length),n=new Map(e.map(e=>[e.webkitRelativePath.split("/")[1]??"",e])),r=n.get("data.json");if(void 0===r)return void t("error",a("message.error.no_main_data_file"),"");const i=await r.text();u.value=()=>{_(N(i),async e=>{const t=n.get(e);return void 0===t?Y.error(a("message.error.file_does_not_exist",{filename:e})):Y.ok(t)})},l.value=!1,o.value=!0})(),a("message.error.failed_loading_database"),t).then(()=>{l.value=!1})}return(e,a)=>{const t=ye;return T(),B(ce,{class:"fill-height"},{default:j(()=>[f(de,{justify:"center"},{default:j(()=>[f(ve,{elevated:"",loading:l.value,"max-width":"648",width:"75%"},{default:j(()=>[f(me,null,{default:j(()=>[P(A(e.$t("message.select_datasource")),1)]),_:1}),f(fe,null,{default:j(()=>[P(A(e.$t("message.select_datasource_detail")),1)]),_:1}),o.value?(T(),B(pe,{key:0},{default:j(()=>[f(W,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),"append-icon":i.value?"mdi-eye-off":"mdi-eye",label:e.$t("message.input_password"),type:i.value?"text":"password",variant:"outlined","onClick:append":a[1]||(a[1]=e=>i.value=!i.value),onKeydown:D(u.value,["enter"])},null,8,["modelValue","append-icon","label","type","onKeydown"]),f(re,{block:"",class:"my-4",color:"primary",disabled:0===r.value.length,onClick:u.value},{default:j(()=>[P(A(e.$t("action.open")),1)]),_:1},8,["disabled","onClick"]),f(re,{block:"",class:"my-3",onClick:a[2]||(a[2]=e=>{r.value="",o.value=!1})},{default:j(()=>[P(A(e.$t("action.back_to_last_step")),1)]),_:1})]),_:1})):(T(),B(pe,{key:1},{default:j(()=>[f(W,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value=e),clearable:"",density:"comfortable",label:e.$t("message.input_remote_url"),"prepend-icon":"mdi-link-variant",onKeydown:a[4]||(a[4]=D(e=>!!m.value&&g(),["enter"]))},{append:j(()=>[f(re,{disabled:!m.value,icon:"mdi-download",onClick:g},null,8,["disabled"])]),_:1},8,["modelValue","label"]),f(_e,{modelValue:v.value,"onUpdate:modelValue":[a[5]||(a[5]=e=>v.value=e),b],density:"compact",label:e.$t("message.input_local_directory"),multiple:"","prepend-icon":"mdi-folder",webkitdirectory:""},null,8,["modelValue","label"]),f(z,null,{default:j(()=>[P(A(e.$t("message.alternative_way")),1)]),_:1}),f(re,{block:"",class:"my-4",color:"info",to:"/NewDatasource"},{default:j(()=>[P(A(e.$t("message.create_new_datasource")),1)]),_:1}),p("div",ke,[f(t)])]),_:1}))]),_:1},8,["loading"])]),_:1})]),_:1})}}}),he=V({__name:"index",setup:e=>(e,a)=>{const t=we;return T(),B(t)}});export{he as default};
