import{p as e,g as a,j as t,d as l,e as n,x as o,n as r,f as i,a as s,a4 as u,s as d,c,a5 as m,h as g,m as p,r as f,a6 as v,O as _,G as h,I as y,M as b,t as x,b as k,k as w,Q as V,i as S,w as $,a7 as C,a8 as I,a2 as j,W as B,a9 as M,aa as U,ab as A,H as P,l as T,N as H,A as E,q as D,v as N,Y as O,K as z,ac as q,ad as L,ae as R,af as W,ag as G,ah as K,ai as F,aj as J,o as Y,y as Q,B as Z,F as X,z as ee,_ as ae,T as te,ak as le,al as ne,am as oe,an as re,Z as ie,ao as se,a3 as ue}from"./index-X2pssZTS.js";import{S as de,V as ce,a as me,b as ge}from"./sorting_types-cEVbskoa.js";import{m as pe,u as fe,a as ve,b as _e,c as he,F as ye,y as be,d as xe,e as ke,f as we,p as Ve,M as Se,L as $e,G as Ce,H as Ie,I as je,J as Be,o as Me,n as Ue,q as Ae,g as Pe,x as Te,i as He,k as Ee,j as De,h as Ne,E as Oe,K as ze,V as qe,v as Le}from"./ssrBoot-BJN1Wy2u.js";import{V as Re}from"./VFileInput-DmSJGwz6.js";import{V as We,a as Ge}from"./VTooltip-C_gWb3ji.js";import{u as Ke,c as Fe,a as Je,p as Ye,b as Qe,d as Ze,e as Xe,f as ea,g as aa,h as ta,i as la,j as na,m as oa,k as ra,l as ia,n as sa,o as ua,q as da,V as ca,r as ma}from"./VPagination-BUgAA66X.js";import{c as ga,d as pa,e as fa,f as va,g as _a,h as ha,a as ya,b as ba,V as xa,i as ka}from"./VSelect-LIMe1IgN.js";import{V as wa}from"./VCol-DQQf74-R.js";import{a as Va,V as Sa,b as $a}from"./VAlert-BxHw4_Lq.js";import{_ as Ca}from"./internal_plugin-vue_export-helper-BCo6x5W8.js";import{a as Ia}from"./VBottomSheet-CTq9fu3t.js";import"./en-DEkKOPRf.js";const ja=e({text:String,...t(),...pe()},"VToolbarTitle"),Ba=a()({name:"VToolbarTitle",props:ja(),setup(e,a){let{slots:t}=a;return l(()=>{const a=!!(t.default||t.text||e.text);return n(e.tag,{class:i(["v-toolbar-title",e.class]),style:r(e.style)},{default:()=>[a&&o("div",{class:"v-toolbar-title__placeholder"},[t.text?t.text():e.text,t.default?.()])]})}),{}}}),Ma=[null,"prominent","default","comfortable","compact"],Ua=e({absolute:Boolean,collapse:Boolean,collapsePosition:{type:String,default:"start"},color:String,density:{type:String,default:"default",validator:e=>Ma.includes(e)},extended:{type:Boolean,default:null},extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...we(),...t(),...ke(),...xe(),...pe({tag:"header"}),...p()},"VToolbar"),Aa=a()({name:"VToolbar",props:Ua(),setup(e,a){let{slots:t}=a;const{backgroundColorClasses:p,backgroundColorStyles:f}=fe(()=>e.color),{borderClasses:v}=ve(e),{elevationClasses:_}=_e(e),{roundedClasses:h}=he(e),{themeClasses:y}=s(e),{rtlClasses:b}=u(),x=d(null===e.extended?!!t.extension?.():e.extended),k=c(()=>parseInt(Number(e.height)+("prominent"===e.density?Number(e.height):0)-("comfortable"===e.density?8:0)-("compact"===e.density?16:0),10)),w=c(()=>x.value?parseInt(Number(e.extensionHeight)+("prominent"===e.density?Number(e.extensionHeight):0)-("comfortable"===e.density?4:0)-("compact"===e.density?8:0),10):0);return m({VBtn:{variant:"text"}}),l(()=>{const a=!(!e.title&&!t.title),l=!(!t.image&&!e.image),s=t.extension?.();return x.value=null===e.extended?!!s:e.extended,n(e.tag,{class:i(["v-toolbar",`v-toolbar--collapse-${e.collapsePosition}`,{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},p.value,v.value,_.value,h.value,y.value,b.value,e.class]),style:r([f.value,e.style])},{default:()=>[l&&o("div",{key:"image",class:"v-toolbar__image"},[t.image?n(be,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},t.image):n(ye,{key:"image-img",cover:!0,src:e.image},null)]),n(be,{defaults:{VTabs:{height:g(k.value)}}},{default:()=>[o("div",{class:"v-toolbar__content",style:{height:g(k.value)}},[t.prepend&&o("div",{class:"v-toolbar__prepend"},[t.prepend?.()]),a&&n(Ba,{key:"title",text:e.title},{text:t.title}),t.default?.(),t.append&&o("div",{class:"v-toolbar__append"},[t.append?.()])])]}),n(be,{defaults:{VTabs:{height:g(w.value)}}},{default:()=>[n(ga,null,{default:()=>[x.value&&o("div",{class:"v-toolbar__extension",style:{height:g(w.value)}},[s])]})]})]})}),{contentHeight:k,extensionHeight:w}}}),Pa=e({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");const Ta=e({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Ua(),...S(),...Pa(),height:{type:[Number,String],default:64}},"VAppBar"),Ha=a()({name:"VAppBar",props:Ta(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:t}=a;const o=f(),r=b(e,"modelValue"),i=c(()=>{const a=new Set(e.scrollBehavior?.split(" ")??[]);return{hide:a.has("hide"),fullyHide:a.has("fully-hide"),inverted:a.has("inverted"),collapse:a.has("collapse"),elevate:a.has("elevate"),fadeImage:a.has("fade-image")}}),s=c(()=>{const e=i.value;return e.hide||e.fullyHide||e.inverted||e.collapse||e.elevate||e.fadeImage||!r.value}),u=c(()=>(o.value?.contentHeight??0)+(o.value?.extensionHeight??0)),{currentScroll:m,scrollThreshold:g,isScrollingUp:p,scrollRatio:S,isAtBottom:C,reachedBottomWhileScrollingDown:I,hasEnoughScrollableSpace:j}=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{canScroll:t,layoutSize:l}=a;let n=0,o=0;const r=f(null),i=d(0),s=d(0),u=d(0),m=d(!1),g=d(!1),p=d(!1),b=d(!1),x=d(!0),k=c(()=>Number(e.scrollThreshold)),w=c(()=>v((k.value-i.value)/k.value||0));function V(e){return{clientHeight:"window"in e?window.innerHeight:e.clientHeight,scrollHeight:"window"in e?document.documentElement.scrollHeight:e.scrollHeight}}function S(){const e=r.value;if(!e)return;const{clientHeight:a,scrollHeight:t}=V(e),n=t-a,o=l?.value||0,i=k.value+o;x.value=n>i}function $(){S()}function C(){const e=r.value;if(!e||t&&!t.value)return;n=i.value,i.value="window"in e?e.pageYOffset:e.scrollTop;const a=e instanceof Window?document.documentElement.scrollHeight:e.scrollHeight;o!==a&&(a>o&&S(),o=a),g.value=i.value<n,u.value=Math.abs(i.value-k.value);const{clientHeight:l,scrollHeight:s}=V(e),d=i.value+l>=s-5;!g.value&&d&&i.value>=k.value&&x.value&&(b.value=!0);const c=Math.abs(i.value-n)>100,m=i.value<=5;(g.value&&n-i.value>1&&!d||c&&i.value<k.value||m)&&(b.value=!1),p.value=d}return _(g,()=>{s.value=s.value||i.value}),_(m,()=>{s.value=0}),h(()=>{_(()=>e.scrollTarget,e=>{const a=e?document.querySelector(e):window;a&&a!==r.value&&(r.value?.removeEventListener("scroll",C),r.value=a,r.value.addEventListener("scroll",C,{passive:!0}),Promise.resolve().then(()=>{S()}))},{immediate:!0}),window.addEventListener("resize",$,{passive:!0})}),y(()=>{r.value?.removeEventListener("scroll",C),window.removeEventListener("resize",$)}),t&&_(t,C,{immediate:!0}),{scrollThreshold:k,currentScroll:i,currentThreshold:u,isScrollActive:m,scrollRatio:w,isScrollingUp:g,savedScroll:s,isAtBottom:p,reachedBottomWhileScrollingDown:b,hasEnoughScrollableSpace:x}}(e,{canScroll:s,layoutSize:u}),B=x(()=>i.value.hide||i.value.fullyHide),M=c(()=>e.collapse||i.value.collapse&&(i.value.inverted?S.value>0:0===S.value)),U=c(()=>e.flat||i.value.fullyHide&&!r.value||i.value.elevate&&(i.value.inverted?m.value>0:0===m.value)),A=c(()=>i.value.fadeImage?i.value.inverted?1-S.value:S.value:void 0),P=c(()=>{if(i.value.hide&&i.value.inverted)return 0;const e=o.value?.contentHeight??0,a=o.value?.extensionHeight??0;return B.value?m.value<g.value||i.value.fullyHide?e+a:e:e+a});k(()=>!!e.scrollBehavior,()=>{$(()=>{B.value?i.value.inverted?r.value=m.value>g.value:j.value?I.value?r.value=!1:r.value=p.value&&!C.value||m.value<g.value:r.value=!0:r.value=!0})});const{ssrBootStyles:T}=Ve(),{layoutItemStyles:H}=w({id:e.name,order:c(()=>parseInt(e.order,10)),position:x(()=>e.location),layoutSize:P,elementSize:d(void 0),active:r,absolute:x(()=>e.absolute)});return l(()=>{const a=Aa.filterProps(e);return n(Aa,V({ref:o,class:["v-app-bar",{"v-app-bar--bottom":"bottom"===e.location},e.class],style:[{...H.value,"--v-toolbar-image-opacity":A.value,height:void 0,...T.value},e.style]},a,{collapse:M.value,flat:U.value}),t)}),{}}}),Ea=a()({name:"VAppBarTitle",props:ja(),setup(e,a){let{slots:t}=a;return l(()=>n(Ba,V(e,{class:"v-app-bar-title"}),t)),{}}}),Da=e({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},returnObject:Boolean},"DataIterator-items");function Na(e,a){return{type:"item",value:e.returnObject?a:C(a,e.itemValue),selectable:C(a,e.itemSelectable,!0),raw:a}}function Oa(e){const a=c(()=>function(e,a){const t=[];for(const l of a)t.push(Na(e,l));return t}(e,e.items));return{items:a}}const za=e({search:String,loading:Boolean,...t(),...Da(),...da(),...ua(),...sa({itemsPerPage:5}),...ia(),...ra(),...oa(),...pe(),...Ce({transition:{component:pa,hideOnLeave:!0}})},"VDataIterator"),qa=a()({name:"VDataIterator",props:za(),emits:{"update:modelValue":e=>!0,"update:groupBy":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:currentItems":e=>!0},setup(e,a){let{slots:t}=a;const s=b(e,"groupBy"),u=x(()=>e.search),{items:d}=Oa(e),{filteredItems:m}=Ke(e,d,u,{transform:e=>e.raw}),{initialSortOrder:g,sortBy:p,multiSort:f,mustSort:v}=Fe(e),{page:_,itemsPerPage:h}=Je(e),{toggleSort:y}=na({initialSortOrder:g,sortBy:p,multiSort:f,mustSort:v,page:_}),{sortByWithGroups:k,opened:w,extractRows:V,isGroupOpen:S,toggleGroup:$}=Ye({groupBy:s,sortBy:p}),{sortedItems:C}=Qe(e,m,k,{transform:e=>e.raw}),{flatItems:I}=Ze(C,s,w,!1),j=x(()=>I.value.length),{startIndex:B,stopIndex:M,pageCount:U,prevPage:A,nextPage:P,setItemsPerPage:T,setPage:H}=Xe({page:_,itemsPerPage:h,itemsLength:j}),{paginatedItems:E}=ea({items:I,startIndex:B,stopIndex:M,itemsPerPage:h}),D=c(()=>V(E.value)),{isSelected:N,select:O,selectAll:z,toggleSelect:q}=aa(e,{allItems:d,currentPage:D}),{isExpanded:L,toggleExpand:R}=ta(e);la({page:_,itemsPerPage:h,sortBy:p,groupBy:s,search:u});const W=c(()=>({page:_.value,itemsPerPage:h.value,sortBy:p.value,pageCount:U.value,toggleSort:y,prevPage:A,nextPage:P,setPage:H,setItemsPerPage:T,isSelected:N,select:O,selectAll:z,toggleSelect:q,isExpanded:L,toggleExpand:R,isGroupOpen:S,toggleGroup:$,items:D.value,itemsCount:m.value.length,groupedItems:E.value}));return l(()=>n(e.tag,{class:i(["v-data-iterator",{"v-data-iterator--loading":e.loading},e.class]),style:r(e.style)},{default:()=>[t.header?.(W.value),n(Se,{transition:e.transition},{default:()=>[e.loading?n($e,{key:"loader",name:"v-data-iterator",active:!0},{default:e=>t.loader?.(e)}):o("div",{key:"items"},[E.value.length?t.default?.(W.value):t["no-data"]?.()])]}),t.footer?.(W.value)]})),{}}}),La=e({disabled:Boolean,modelValue:{type:Boolean,default:null},...je()},"VHover"),Ra=a()({name:"VHover",props:La(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:t}=a;const l=b(e,"modelValue"),{runOpenDelay:n,runCloseDelay:o}=Ie(e,a=>!e.disabled&&(l.value=a));return()=>t.default?.({isHovering:l.value,props:{onMouseenter:n,onMouseleave:o}})}}),Wa=e({modelValue:Boolean,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},...t(),...Ue(),...pe(),...Ce({transition:"fade-transition"})},"VLazy"),Ga=a()({name:"VLazy",directives:{vIntersect:Be},props:Wa(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:t}=a;const{dimensionStyles:o}=Me(e),s=b(e,"modelValue");function u(e){s.value||(s.value=e)}return l(()=>I(n(e.tag,{class:i(["v-lazy",e.class]),style:r([o.value,e.style])},{default:()=>[s.value&&n(Se,{transition:e.transition,appear:!0},{default:()=>[t.default?.()]})]}),[[Be,{handler:u,options:e.options},null]])),{}}});function Ka(e){const a=Math.round(e);return a<0?`-${a.toString().padStart(18,"0")}`:a.toString().padStart(19,"0")}function Fa(e){const a=function(e){const a=e.match(/\d+/);return null===a?null:a[0]}(e);return null===a?a:Ka(Number(a))}function Ja(e){const a=new Date(e).valueOf();return Number.isNaN(a)?null:Ka(a)}function Ya(e,a,t){switch(e.type){case"string":return function(e,a){switch(e.sorting_method){case de.AsDate:return Ja(a.value);case de.AsNumber:return Fa(a.value);case de.AsString:return a.value;default:return null}}(e,a);case"rating":return function(e,a){return e.sorting_method===de.AsNumber?Ka(a.score):null}(e,a);case"tag":return void 0===t?null:function(e,a,t){if(e.sorting_method===de.Disabled)return null;const l=Math.ceil(Math.log10(t.length));return a.tags.map(e=>e.toString().padStart(l,"0")).join("")}(e,a,t)}}const{t:Qa}=B.global;const Za=new Map([["string",function(e,a){if("string"!=typeof e)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.expected_string"));if(0===e.length&&!a.optional)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.missing_required_entry",[a.name]));const t={value:e};return j.ok(t)}],["tag",function(e,a){const t=P();if(!Array.isArray(e))return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.expected_array"));if(e.some(e=>"string"!=typeof e||0===e.length))return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.expected_string"));const l=a;if(l.exclusive&&e.length>1)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.exclusive_tag",[l.name]));if(!l.optional&&0===e.length)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.missing_required_entry",[l.name]));const n={tags:t.prepare_tag_registration().register_tags(a.name,e).toSorted()};return j.ok(n)}],["rating",function(e,a){if("object"!=typeof e||void 0===e.score)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.invalid_rating_entry"));if(!a.optional&&0===e.score)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.missing_required_entry",[a.name]));const t={score:e.score,comment:e.comment??void 0};return j.ok(t)}]]);const Xa=T({__name:"DataImporter",emits:["done"],setup(e,{emit:a}){const{t:t}=B.global,l=P(),o=f(!1),r=f(0),i=f(0),s=a,u=H(Ae);function d(e){const a=e.lastIndexOf(".");return a<=0?e:e.slice(0,a)}async function c(e,a){let n=0;const o=()=>{n+=1,r.value=n/e.length*100},i=await Promise.all(e.map(async e=>{const n=await e.text();try{const r=await async function(e,a,t){const l=(()=>{try{return j.ok(JSON.parse(a))}catch(e){return j.error(Qa("message.error.cannot_parse_JSON"),String(e))}})();if(l.is_err())return l.erase_type();const n=l.unwrap();if("object"!=typeof n)return j.error(Qa("message.error.invalid_data_format"),"The top-level must be an object");const o={data:{entries:e.entries.length>0?new Map:void 0}};for(const r of e.entries){if(void 0===n[r.name]){if(!r.optional)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.missing_required_entry",[r.name]));continue}const e=n[r.name],a=Za.get(r.type)(e,r);if(a.is_err())return a.erase_type();const t=a.unwrap();if(r.sorting_method!==de.Disabled&&null===Ya(r,t,[]))return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.invalid_formatting",[r.name]));o.data.entries.set(r.name,t)}if(void 0!==e.image_size){if(void 0===t)return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.image_not_found"));const a=await M(t,e.image_size,A,U);if(a.is_err())return j.error(Qa("message.error.invalid_data_format"),Qa("message.error.failed_to_import_image"));o.images=a.unwrap()}return j.ok(o)}(l.database_.configurations.entry,n,a.get(d(e.name)));return o(),r.is_err()?(u("error",t("message.error.failed_to_parse_imported_data"),String(r.unwrap_error())),null):r.unwrap()}catch(r){return u("error",t("message.error.failed_to_parse_imported_data"),String(r)),o(),null}}));if(i.includes(null))return void s("done");const c=await l.place_item(i.map(({data:e,images:a})=>({source:e,images:a})));s("done"),c.length>0&&u("error",t("message.error.failed_to_import_reasons"),c.map(({index:a,reason:t})=>`${e[a].name}: ${L(t)}`).slice(0,24).join("\n"))}const m=f([]);function g(e){if(void 0===e)return;const a=e instanceof File?[e]:e;m.value=[],o.value=!0,async function(e){const a=e.length,t=[],l=new Map;for(const[n,o]of e.entries())o.name.endsWith(".json")?t.push(o):l.set(d(o.name),o),i.value=(n+1)/a*100;await c(t,l)}(a).then(()=>{o.value=!1})}return(e,a)=>(D(),E(We,null,{default:N(()=>[n(Pe,null,{default:N(()=>[z(o)?(D(),E(Te,{key:0,modelValue:z(r),"onUpdate:modelValue":a[0]||(a[0]=e=>q(r)?r.value=e:null),"buffer-value":z(i),color:"secondary",stream:""},null,8,["modelValue","buffer-value"])):O("",!0),n(z(Re),{modelValue:z(m),"onUpdate:modelValue":[a[1]||(a[1]=e=>q(m)?m.value=e:null),g],"hide-input":"",multiple:"","prepend-icon":"mdi-file-multiple"},null,8,["modelValue"])]),_:1})]),_:1}))}});var et=(e=>(e[e.ExactMatch=0]="ExactMatch",e[e.PrefixMatches=1]="PrefixMatches",e[e.SubstringMatches=2]="SubstringMatches",e[e.Creation=3]="Creation",e))(et||{});function at(e,a,t){const l=a.map((e,a)=>({value:e,index:a})),[n,o]=R(l,({value:a})=>a===e),[r,i]=R(o,({value:a})=>a.startsWith(e)),s=i.filter(({value:a})=>a.includes(e)),u=[...n.map(({value:e,index:a})=>({type:0,value:a,display:e})),...r.map(({value:e,index:a})=>({type:1,value:a,display:e})),...s.map(({value:e,index:a})=>({type:2,value:a,display:e}))];return t?.allow_creating&&0===n.length&&u.push({type:3,value:e,display:e}),u}const tt={key:0,class:"fill-width"},lt={class:"text-h5 mb-6"},nt={class:"mb-4 text-medium-emphasis text-body-2"},ot={class:"text-h5"},rt={class:"text-h5"},it=Ca(T({__name:"BatchedTagEditor",props:{itemIds:{}},emits:["close"],setup(e,{emit:a}){const{t:t}=B.global,l=W(),r=P(),i=H(Ae),s=e,u=a,d=G({ready:!1,tag_modifications:[],items:[],focused_item:""}),m=K("from-tags"),g=K("to-tags"),p=K("from-container"),v=K("to-container");function _(e,a,t){if(a){const a=a=>a.$el.dataset.itemId===e,n=("from"===t?m:g).value.find(e=>a(e)),o=("from"===t?g:m).value.find(e=>a(e)),r="from"===t?p:v,i="from"===t?v:p,s=n.$el.getBoundingClientRect().y-r.value.$el.getBoundingClientRect().y;te().then(()=>{l(o,{offset:-s,container:i.value,easing:"easeInOutCubic"}).then(()=>{d.focused_item=e})})}else e===d.focused_item&&(d.focused_item="")}const y=c(()=>d.tag_modifications.filter(({enabled:e})=>e)),b=c(()=>d.items.map((e,a)=>{const t=[],l=[];for(const n of y.value){const a=e.entries.get(n.config.name),o=(a?.tags??[]).filter(e=>!n.removed.includes(e)),r=n.added.filter(e=>"string"==typeof e||!o.includes(e)).concat(o);if(t.push(r),n.config.exclusive&&r.length>1){const e={type:F.exclusive,key:n.config.name};l.push(e)}else if(n.config.optional||0!==r.length)l.push(null);else{const e={type:F.missing,key:n.config.name};l.push(e)}}return{id:s.itemIds[a],data:e,modified_tags:t,errors:l}})),x=G([]),k=c(()=>x.map(({add_mode:e,content:a},t)=>{const l=d.tag_modifications[t];return at(a,l.tag_pool,{allow_creating:e&&a.length>0}).map(({display:e,value:a})=>({display_name:e,internal_value:a})).filter(({internal_value:e})=>!(l.added.includes(e)||"string"!=typeof e&&l.removed.includes(e)))})),w=c(()=>x.map(({content:e},a)=>k.value[a].every(({display_name:a})=>a!==e)));function S(e,a){x[e].content="";x[e].add_mode?d.tag_modifications[e].added.push(a):d.tag_modifications[e].removed.push(a)}h(()=>{d.tag_modifications=r.entries.filter(e=>"tag"===e.type).map(e=>({config:J(e),tag_pool:r.tags.get(e.name)??[],enabled:!1,added:[],removed:[]}));for(const e of d.tag_modifications)x.push({add_mode:!0,content:""});d.items=s.itemIds.map(e=>r.data.get(e)),d.ready=!0});const $=f(!1);function C(){$.value=!0,async function(){const e=r.prepare_tag_registration(),a=y.value,l=new Set(a.map(({config:e})=>e.name)),n=b.value.map(({id:t,data:n,modified_tags:o})=>{const i=r.entries.map(e=>{if("tag"===e.type&&l.has(e.name))return null;const a=n.entries?.get(e.name);return void 0===a?null:[e.name,a]}).filter(e=>null!==e),s=new Map(i);for(const[l,r]of o.entries()){if(0===r.length)continue;const[t,n]=R(r,e=>"number"==typeof e),o=a[l].config,i=e.register_tags(o.name,n),u={tags:t.concat(i)};s.set(o.name,u)}return{runtime_id:t,source:{image:n.image,entries:s}}}),o=await r.place_item(n);0!==o.length?i("error",t("cannot_commit_modification"),o.map(({index:e,reason:a})=>`${e}: ${L(a)}`).join("\n")):u("close")}().finally(()=>{$.value=!1})}return(e,a)=>d.ready?(D(),Y("div",tt,[n(He,{class:"mb-6"},{default:N(()=>[n(Ee,{style:{"text-align":"center"}},{default:N(()=>[Q(Z(e.$t("message.tags_to_be_modified")),1)]),_:1}),n(De,null,{default:N(()=>[d.tag_modifications.length>0?(D(!0),Y(X,{key:0},ee(d.tag_modifications,(e,a)=>(D(),E(He,{key:e.config.name,class:"mx-auto my-2",title:e.config.name},{append:N(()=>[n(ce,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,color:"primary","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),default:N(()=>[n(De,null,{default:N(()=>[n(ca,{search:x[a].content,"onUpdate:search":e=>x[a].content=e,error:w.value[a],"hide-no-data":"",items:k.value[a],"no-filter":"","prepend-icon":x[a].add_mode?"mdi-plus":"mdi-minus","onClick:prepend":e=>x[a].add_mode=!x[a].add_mode,onKeydown:ae(e=>!1===w.value[a]&&S(a,k.value[a].at(0).internal_value),["enter"])},{item:N(({item:e})=>[n(fa,{onClick:t=>S(a,e.raw.internal_value)},{default:N(()=>[n(va,null,{default:N(()=>[Q(Z(e.raw.display_name),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["search","onUpdate:search","error","items","prepend-icon","onClick:prepend","onKeydown"]),n(_a,null,{default:N(()=>[(D(!0),Y(X,null,ee(e.added,(a,t)=>(D(),E(fa,{key:a,"prepend-icon":"mdi-plus",title:"string"==typeof a?a:e.tag_pool[a]},{append:N(()=>[n(Ne,{icon:"mdi-close-circle",onClick:a=>e.added.splice(t,1)},null,8,["onClick"])]),_:2},1032,["title"]))),128)),(D(!0),Y(X,null,ee(e.removed,(a,t)=>(D(),E(fa,{key:a,"prepend-icon":"mdi-minus",title:e.tag_pool[a]},{append:N(()=>[n(Ne,{icon:"mdi-close-circle",onClick:a=>e.removed.splice(t,1)},null,8,["onClick"])]),_:2},1032,["title"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128)):(D(),E(We,{key:1,class:"pa-4 text-center mx-auto"},{default:N(()=>[n(Oe,{class:"mb-5",icon:"mdi-tag-off",size:"112"}),o("h2",lt,Z(e.$t("message.no_tag_to_be_edited.title")),1),o("p",nt,Z(e.$t("message.no_tag_to_be_edited.description")),1)]),_:1}))]),_:1}),n(ze,{class:"justify-end"},{default:N(()=>[n(Ne,{color:"primary",disabled:b.value.some(({errors:e})=>e.some(e=>null!==e)),loading:$.value,onClick:C},{default:N(()=>[Q(Z(e.$t("action.confirm")),1)]),_:1},8,["disabled","loading"]),n(Ne,{onClick:a[0]||(a[0]=e=>u("close"))},{default:N(()=>[Q(Z(e.$t("action.cancel")),1)]),_:1})]),_:1})]),_:1}),n(qe,null,{default:N(()=>[n(wa,{ref:"from-container",class:"preview-container",cols:"6"},{default:N(()=>[0===y.value.length?(D(),E(We,{key:0,class:"py-4 text-center mx-auto"},{default:N(()=>[n(Oe,{class:"mb-5",icon:"mdi-database"}),o("h2",ot,Z(e.$t("message.tags_in_database")),1)]),_:1})):(D(!0),Y(X,{key:1},ee(b.value,e=>(D(),E(Ra,{key:e.id,"open-delay":"300","onUpdate:modelValue":a=>{_(e.id,a,"from")}},{default:N(({props:a})=>[n(He,V({ref_for:!0},a,{ref_for:!0,ref:"from-tags",class:"mb-4",color:d.focused_item===e.id?"primary":"","data-item-id":e.id}),{default:N(()=>[(D(!0),Y(X,null,ee(y.value,a=>(D(),Y(X,{key:a.config.name},[n(Ee,null,{default:N(()=>[Q(Z(a.config.name),1)]),_:2},1024),n(De,null,{default:N(()=>[n(qe,null,{default:N(()=>[(D(!0),Y(X,null,ee(e.data.entries.get(a.config.name)?.tags??[],e=>(D(),E(wa,{key:e,class:"flex-grow-0"},{default:N(()=>[n(ha,null,{default:N(()=>[Q(Z(a.tag_pool[e]),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)],64))),128))]),_:2},1040,["color","data-item-id"])]),_:2},1032,["onUpdate:modelValue"]))),128))]),_:1},512),n(wa,{ref:"to-container",class:"preview-container",cols:"6"},{default:N(()=>[0===y.value.length?(D(),E(We,{key:0,class:"py-4 text-center mx-auto"},{default:N(()=>[n(Oe,{class:"mb-5",icon:"mdi-database-edit"}),o("h2",rt,Z(e.$t("message.tags_preview")),1)]),_:1})):(D(!0),Y(X,{key:1},ee(b.value,a=>(D(),E(Ra,{key:a.id,"open-delay":"300","onUpdate:modelValue":e=>{_(a.id,e,"to")}},{default:N(({props:t})=>[n(He,V({ref_for:!0},t,{ref_for:!0,ref:"to-tags",class:"mb-4",color:d.focused_item===a.id?"primary":"","data-item-id":a.id}),{default:N(()=>[(D(!0),Y(X,null,ee(y.value,(t,l)=>(D(),Y(X,{key:t.config.name},[n(Ee,null,{default:N(()=>[Q(Z(t.config.name),1)]),_:2},1024),n(De,null,{default:N(()=>[a.errors[l]?(D(),E(Va,{key:0,class:"mb-2",title:e.$t("message.error.entry_contains_error"),type:"error"},{default:N(()=>[Q(Z(z(L)(a.errors[l])),1)]),_:2},1032,["title"])):O("",!0),n(qe,null,{default:N(()=>[(D(!0),Y(X,null,ee(a.modified_tags[l],e=>(D(),E(wa,{key:e,class:"flex-grow-0"},{default:N(()=>[n(ha,null,{default:N(()=>[Q(Z("string"==typeof e?e:t.tag_pool[e]),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)],64))),128))]),_:2},1040,["color","data-item-id"])]),_:2},1032,["onUpdate:modelValue"]))),128))]),_:1},512)]),_:1})])):O("",!0)}}),[["__scopeId","data-v-a95c483e"]]),st=T({__name:"ItemTagEditor",props:le({entryName:{},configuration:{}},{data:{required:!0},dataModifiers:{}}),emits:["update:data"],setup(e){const a=e,t=P(),l=ne(e,"data"),o=J(t.tags.get(a.entryName)??[]),r=f(""),i=c(()=>l.value.tags.map(e=>({display:"string"==typeof e?e:o[e],value:e}))),s=c(()=>{if(void 0===l.value)return[];const e=r.value.trim();if(0===e.length)return[];const a=new Set(i.value.map(({value:e})=>e));return at(e,o,{allow_creating:!0}).filter(({value:e})=>!a.has(e))});return(a,t)=>(D(),E(qe,{class:"ma-2"},{default:N(()=>[i.value.length>0?(D(!0),Y(X,{key:0},ee(i.value,e=>(D(),E(wa,{key:e.display},{default:N(()=>[n(ha,{closable:"","onClick:close":a=>function(e){const a=l.value.tags.indexOf(e);l.value.tags.splice(a,1)}(e.value)},{default:N(()=>[Q(Z(e.display),1)]),_:2},1032,["onClick:close"])]),_:2},1024))),128)):O("",!0),n(wa,{cols:"12"},{default:N(()=>[n(ya,{modelValue:z(r),"onUpdate:modelValue":t[0]||(t[0]=e=>q(r)?r.value=e:null),disabled:e.configuration.exclusive&&i.value.length>0},null,8,["modelValue","disabled"])]),_:1}),(D(!0),Y(X,null,ee(s.value,e=>(D(),E(wa,{key:e.display},{default:N(()=>[n(ha,{color:e.type===z(et).ExactMatch?"primary":e.type===z(et).Creation?"":"secondary","prepend-icon":e.type===z(et).Creation?"mdi-plus":"",onClick:a=>{return t=e.value,l.value.tags.push(t),void(r.value="");var t}},{default:N(()=>[Q(Z(e.display),1)]),_:2},1032,["color","prepend-icon","onClick"])]),_:2},1024))),128))]),_:1}))}}),ut=T({__name:"ItemRatingEditor",props:le({configuration:{}},{data:{required:!0},dataModifiers:{}}),emits:["update:data"],setup(e){const a=ne(e,"data");return _(a.value,()=>{a.value.comment.trim()!==a.value.comment&&(a.value.comment=a.value.comment.trim())}),(t,l)=>(D(),Y(X,null,[n(qe,{justify:"space-around"},{default:N(()=>[n(me,{modelValue:a.value.score,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.score=e),clearable:"",density:"comfortable",length:e.configuration.maximum_score},null,8,["modelValue","length"])]),_:1}),n(qe,{justify:"space-around"},{default:N(()=>[n(wa,{cols:"1"},{default:N(()=>[n(ce,{modelValue:a.value.use_comment,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.use_comment=e),color:"primary",disabled:0===a.value.score},null,8,["modelValue","disabled"])]),_:1}),n(wa,{cols:"10"},{default:N(()=>[n(ya,{modelValue:a.value.comment,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.comment=e),disabled:!a.value.use_comment},null,8,["modelValue","disabled"])]),_:1})]),_:1})],64))}}),dt=T({__name:"ItemStringEditor",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(e){const a=ne(e,"data");return _(a.value,()=>{a.value.value.trim()!==a.value.value&&(a.value.value=a.value.value.trim())}),(e,t)=>(D(),E(ya,{modelValue:a.value.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.value=e)},null,8,["modelValue"]))}}),ct={class:"fill-width"},mt={key:0},gt={key:1},pt=T({__name:"ItemRatingDisplay",props:{data:{},configuration:{}},setup(e){const a=e,t=c(()=>{const e=a.data,t=void 0!==e.use_comment;return[(a.configuration.hints??[])[e.score]??"",t?e.use_comment?e.comment:"":e.comment]});return(a,l)=>(D(),Y("div",ct,[n(me,{modelValue:e.data.score,"onUpdate:modelValue":l[0]||(l[0]=a=>e.data.score=a),class:"fill-width mx-auto",density:"comfortable",length:e.configuration.maximum_score,readonly:""},null,8,["modelValue","length"]),t.value[0]?(D(),Y("p",mt,Z(t.value[0]),1)):O("",!0),t.value[1]?(D(),Y("p",gt,Z(t.value[1]),1)):O("",!0)]))}}),ft=T({__name:"ItemStringDisplay",props:{data:{},configuration:{}},setup(e){const a=e;return(e,t)=>(D(),Y("span",null,Z(a.data.value),1))}}),vt=T({__name:"ItemTagDisplay",props:{data:{},configuration:{}},setup(e){const a=P();return(t,l)=>(D(),E(qe,null,{default:N(()=>[(D(!0),Y(X,null,ee(e.data.tags,t=>(D(),E(wa,{key:t,class:"flex-grow-0"},{default:N(()=>[n(ha,null,{default:N(()=>[Q(Z("number"==typeof t?z(a).tags.get(e.configuration.name)[t]??"":t),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))}}),_t={key:0,class:"fill-width"},ht={style:{display:"grid","grid-template-columns":"max-content 1fr",gap:"24px 16px"}},yt={style:{width:"max-content"}},bt={style:{display:"grid","grid-template-columns":"1fr",gap:"8px"}},xt=Ca(T({__name:"ItemViewer",props:{dataId:{},data:{},configuration:{},overrideImage:{},inEditor:{type:Boolean},updateBroadcast:{},selection:{}},emits:["requestModify","select","unselect"],setup(e,{emit:a}){const t={string:ft,tag:vt,rating:pt},l=P(),r=e,i=a,s=f(void 0),u=c(()=>r.configuration?r.configuration.filter(e=>r.data.entries?.has(e.name)):[]),d=f("");function m(){const e=l.get_cached_image(r.dataId);void 0===e?(l.get_thumbnail(r.dataId).then(e=>{e.map(e=>d.value=e)}),s.value=()=>{l.get_image(r.dataId).then(e=>{e.map(e=>{s.value=void 0,d.value=e})})}):d.value=e}h(()=>{null===r.overrideImage&&(m(),void 0!==r.updateBroadcast&&_(r.updateBroadcast,e=>{e.has(r.dataId)&&m()}))});const g=f(!1);function p(){i("requestModify",r.dataId),g.value=!1}return(a,c)=>(D(),E(Ge,{modelValue:z(g),"onUpdate:modelValue":c[2]||(c[2]=e=>q(g)?g.value=e:null),"close-delay":"300",disabled:e.inEditor,interactive:"","open-delay":"500"},{activator:N(({props:a})=>[n(He,V(a,{color:e.selection?.has(e.dataId)?"primary":""}),{default:N(()=>[z(l).has_image?(D(),Y("div",_t,[n(Ga,null,{default:N(()=>[n(ye,{"aspect-ratio":`${z(l).image_size.width}/${z(l).image_size.height}`,class:"image-display",src:e.overrideImage??z(d),style:{margin:"auto"},width:"100%",onClick:z(s)},{placeholder:N(()=>[...c[3]||(c[3]=[o("div",{class:"align-center justify-center fill-height",style:{background:"linear-gradient(to right, #f0c27b, #4b1248)"}},null,-1)])]),_:1},8,["aspect-ratio","src","onClick"])]),_:1})])):O("",!0),n(De,null,{default:N(()=>[o("div",ht,[(D(!0),Y(X,null,ee(u.value,e=>(D(),Y(X,{key:e.name},[o("p",yt,Z(e.name),1),(D(),E(oe(t[e.type]),{configuration:e,data:r.data.entries?.get(e.name)},null,8,["configuration","data"]))],64))),128))])]),_:1})]),_:1},16,["color"])]),default:N(()=>[o("div",bt,[n(Ne,{block:"",onClick:p},{default:N(()=>[Q(Z(a.$t("action.edit")),1)]),_:1}),e.selection?.has(e.dataId)?(D(),E(Ne,{key:0,block:"",onClick:c[0]||(c[0]=a=>i("unselect",e.dataId))},{default:N(()=>[Q(Z(a.$t("action.unselect")),1)]),_:1})):(D(),E(Ne,{key:1,block:"",onClick:c[1]||(c[1]=a=>i("select",e.dataId))},{default:N(()=>[Q(Z(a.$t("action.select")),1)]),_:1}))])]),_:1},8,["modelValue","disabled"]))}}),[["__scopeId","data-v-e789c000"]]);function kt(e,a){return e.sorting_method!==de.Disabled&&null===Ya(e,a,[])?{type:F.formatting,expected_format:e.sorting_method}:null}const wt=new Map([["string",function(e,a){if("string"!==e.type)return null;const t=a;return void 0===t||""===t.value?e.optional?null:{type:F.missing,key:e.name}:kt(e,t)}],["rating",function(e,a){if("rating"!==e.type)return null;const t=a;return void 0===t||0===t.score?e.optional?null:{type:F.missing,key:e.name}:kt(e,t)}],["tag",function(e,a){if("tag"!==e.type)return null;const t=a;return void 0===t||0===t.tags.length?e.optional?null:{type:F.missing,key:e.name}:e.exclusive&&t.tags.length>1?{type:F.exclusive,key:e.name}:kt(e,t)}]]);const Vt=Ca(T({__name:"ItemEditor",props:{data:{},dataId:{}},emits:["done"],setup(e,{emit:a}){const{t:t}=B.global,l=H(Ae),i=P(),s=e,u=a,d=c(()=>({sm:i.has_image?"":"12",md:i.has_image?"":"12",lg:i.has_image?"":"6",xl:i.has_image?"":"6",xxl:i.has_image?"":"4"})),m=c(()=>i.has_image?`width: ${i.image_size.width}px`:""),g=f({entries:new Map}),p=f(""),v=f(!1),_=c(()=>{if(!1===v.value)return{entries:new Map};const e=i.database_.configurations.entry.entries.map(e=>{const a=g.value.entries.get(e.name);if(("string"!==e.type||""!==a.value)&&!("tag"===e.type&&0===a.tags.length||"rating"===e.type&&0===a.score))return[e.name,a]}).filter(e=>null!=e);return{image:g.value.image,entries:new Map(e)}}),y={image_url:null,image_bitmap:null,thumbnail_url:null,thumbnail_bitmap:null};h(()=>{if(y.image_url=null,y.image_bitmap=null,y.thumbnail_url=null,y.thumbnail_bitmap=null,void 0!==s.data&&void 0!==s.dataId){if(g.value.image=void 0===s.data.image?void 0:{...s.data.image},s.data.entries)for(const[e,a]of s.data.entries.entries()){switch(i.database_.configurations.entry.entries.find(a=>a.name===e).type){case"rating":{const t=a;g.value.entries.set(e,{score:t.score,comment:t.comment??"",use_comment:!!t.comment});break}case"string":{const t=a;g.value.entries.set(e,{value:t.value});break}case"tag":{const t=a;g.value.entries.set(e,{tags:[...t.tags]});break}}}i.has_image&&i.get_image(s.dataId).then(e=>{e.map(e=>p.value=e)})}for(const e of i.database_.configurations.entry.entries)if(!g.value.entries.has(e.name))switch(e.type){case"string":g.value.entries.set(e.name,{value:""});break;case"tag":g.value.entries.set(e.name,{tags:[]});break;case"rating":g.value.entries.set(e.name,{score:0,comment:"",use_comment:!1})}v.value=!0});const b=f(void 0);function x(e){M(e,i.image_size,A,U).then(e=>{if(b.value=void 0,e.is_err())return void l("error",t("message.error.failed_to_import_image"),String(e.unwrap_error()));const a=e.unwrap();null!==y.image_bitmap&&(y.image_bitmap.close(),URL.revokeObjectURL(y.image_url),y.thumbnail_bitmap.close(),URL.revokeObjectURL(y.thumbnail_url)),y.image_bitmap=a.image,y.thumbnail_bitmap=a.thumbnail,y.image_url=a.image_url,y.thumbnail_url=a.thumbnail_url,p.value=y.image_url,k.url=""})}const k=G({url:"",loading:!1});function w(){k.loading=!0;const e=re(k.url);null!==e?(async()=>{try{const a=await fetch(e);if(!a.ok)return void l("error",t("message.error.failed_to_fetch_data",{source:e}),a.statusText);x(await a.blob())}catch(a){l("error",t("message.error.failed_to_fetch_data",{source:e}),String(a))}})().catch(a=>{l("error",t("message.error.failed_to_fetch_data",{source:e}),String(a))}).finally(()=>{k.loading=!1}):l("error",t("message.error.invalid_url"),"")}function V(e){b.value=void 0,void 0===e||Array.isArray(e)||x(e)}const S=c(()=>!1===v.value?[]:function(e,a,t){const l=[];void 0!==t.image_size&&void 0===e.image&&""===a&&l.push({type:F.missing});for(const n of t.entries){const a=wt.get(n.type)(n,e.entries.get(n.name));null!==a&&l.push(a)}return l}(_.value,p.value,i.database_.configurations.entry));const $=f(!1);function C(){$.value=!0,async function(){const e={},a=(()=>{if(null!==y.image_bitmap)return{image:y.image_bitmap,image_url:y.image_url,thumbnail:y.thumbnail_bitmap,thumbnail_url:y.thumbnail_url}})();e.image=g.value.image,i.entries.length>0&&(e.entries=new Map);const n=i.prepare_tag_registration();for(const t of i.entries){const a=_.value.entries.get(t.name);if(void 0!==a)switch(t.type){case"string":e.entries.set(t.name,a);break;case"rating":{const l=a,n={score:l.score,comment:l.use_comment&&l.comment?l.comment:void 0};e.entries.set(t.name,n);break}case"tag":{const l=a,[o,r]=R(l.tags,e=>"number"==typeof e),i=n.register_tags(t.name,r),s={tags:o.concat(i).toSorted()};e.entries.set(t.name,s);break}}}const o=await i.place_item([{runtime_id:s.dataId,source:e,images:a}]);0!==o.length?l("error",t("message.error.cannot_commit_modification"),o.map(({reason:e})=>L(e)).join("; ")):u("done")}().then(()=>{$.value=!1})}return(e,a)=>{const t=xt,l=dt,c=ut,f=st;return D(),E(qe,null,{default:N(()=>[n(wa,{class:"display-column",lg:d.value.lg,md:d.value.md,sm:d.value.sm,style:r(m.value),xl:d.value.xl,xxl:d.value.xxl},{default:N(()=>[n(t,{configuration:z(i).database_.configurations.entry.entries,data:_.value,"data-id":s.dataId??"","in-editor":!0,"override-image":z(p)},null,8,["configuration","data","data-id","override-image"])]),_:1},8,["lg","md","sm","style","xl","xxl"]),n(wa,{class:"display-column",lg:d.value.lg,md:d.value.md,sm:d.value.sm,style:r(m.value),xl:d.value.xl,xxl:d.value.xxl},{default:N(()=>[n(He,{loading:z($)},{default:N(()=>[z(i).has_image?(D(),E(De,{key:0},{default:N(()=>[n(Ne,{block:"",class:"mb-6",onClick:a[0]||(a[0]=e=>u("done"))},{default:N(()=>[Q(Z(e.$t("action.cancel")),1)]),_:1}),n(ya,{modelValue:k.url,"onUpdate:modelValue":a[1]||(a[1]=e=>k.url=e),clearable:"",density:"comfortable",label:e.$t("message.load_image_from_url"),loading:k.loading,"prepend-icon":"mdi-link-variant","onClick:clear":a[2]||(a[2]=e=>k.url=""),onKeydown:ae(w,["enter"])},{append:N(()=>[n(Ne,{disabled:0===k.url.length,icon:"mdi-download",loading:k.loading,onClick:w},null,8,["disabled","loading"])]),_:1},8,["modelValue","label","loading"]),n(z(Re),{modelValue:z(b),"onUpdate:modelValue":[a[3]||(a[3]=e=>q(b)?b.value=e:null),V],accept:"image/*",density:"compact",label:e.$t("message.load_image_from_file"),"prepend-icon":"mdi-image"},null,8,["modelValue","label"])]),_:1})):O("",!0),z(v)?(D(),E(De,{key:1},{default:N(()=>[(D(!0),Y(X,null,ee(z(i).database_?.configurations.entry.entries,(e,a)=>(D(),E(qe,{key:a},{default:N(()=>[n(wa,{cols:"12"},{default:N(()=>[z(i).has_image||0!==a?(D(),E(ba,{key:0})):O("",!0)]),_:2},1024),n(wa,{cols:"12"},{default:N(()=>[o("p",null,Z(e.name),1)]),_:2},1024),n(wa,{cols:"12"},{default:N(()=>["string"===e.type?(D(),E(l,{key:0,data:z(g).entries.get(e.name)},null,8,["data"])):"rating"===e.type?(D(),E(c,{key:1,configuration:e,data:z(g).entries.get(e.name)},null,8,["configuration","data"])):"tag"===e.type?(D(),E(f,{key:2,configuration:e,data:z(g).entries.get(e.name),"entry-name":e.name},null,8,["configuration","data","entry-name"])):O("",!0)]),_:2},1024)]),_:2},1024))),128)),S.value.length>0?(D(),E(Sa,{key:0,class:"my-6",color:"error",icon:"$error"},{default:N(()=>[n($a,null,{default:N(()=>[Q(Z(`${e.$t("message.error.cannot_commit_modification")}\n${S.value.map(z(L)).join("; ")}`),1)]),_:1})]),_:1})):O("",!0),n(qe,{justify:"space-around"},{default:N(()=>[n(wa,{cols:"5"},{default:N(()=>[n(Ne,{block:"",color:"primary",disabled:S.value.length>0,onClick:C},{default:N(()=>[Q(Z(e.$t("action.confirm")),1)]),_:1},8,["disabled"])]),_:1}),n(wa,{cols:"5"},{default:N(()=>[n(Ne,{block:"",onClick:a[4]||(a[4]=e=>u("done"))},{default:N(()=>[Q(Z(e.$t("action.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1})):O("",!0)]),_:1},8,["loading"])]),_:1},8,["lg","md","sm","style","xl","xxl"])]),_:1})}}}),[["__scopeId","data-v-a09f7c62"]]);const St=new Map([["string",function(e,a,t,l){const n=e;return l?.exact?n.value===t:n.value.includes(t)}],["tag",function(e,a,t,l){const n=e,o=P().tags.get(a.name);return n.tags.map(e=>o[e]).some(e=>l?.exact?e===t:e.includes(t))}],["rating",function(e,a,t,l){const n=e;return void 0!==n.comment&&(l?.exact?n.comment===t:n.comment.includes(t))}]]);function $t(e,a,t,l){return St.get(a.type)(e,a,t,l)}const Ct=B.global.t;class It{children=[];evaluate(e){return 0===this.children.length||this.children.reduce((a,t)=>this.short_circuit(a)?a:this.reducer(a,t.evaluate(e)),this.starter())}add_child(e){this.children.push(e)}remove_child(e){this.children=this.children.filter(a=>a!==e)}}class jt extends It{short_circuit(e){return!e}reducer(e,a){return e&&a}starter(){return!0}explain(){return this.children.map(e=>e.explain()).join(Ct("logical.and"))}}class Bt extends It{short_circuit(e){return e}reducer(e,a){return e||a}starter(){return!1}explain(){return this.children.map(e=>e.explain()).join(Ct("logical.or"))}}class Mt{#e;constructor(e){this.#e=e}evaluate(e){return!this.#e.evaluate(e)}explain(){return`${Ct("logical.not")}${this.#e.explain()}`}}class Ut{#a;#t;constructor(e,a){this.#a=e,this.#t=a}evaluate(e){return this.#t.some(a=>{const t=e.entries?.get(a.name);if(void 0===t)return!1;return $t(t,a,this.#a)})}explain(){return Ct("acTion.includes",[this.#a])}}class At{entry_config;constructor(e){this.entry_config=e}evaluate(e){return e.entries?.has(this.entry_config.name)??!1}explain(){return Ct("acTion.includes_entry",[this.entry_config.name])}}class Pt extends At{#l;constructor(e,a){super(e),this.#l=a}evaluate(e){return!!super.evaluate(e)&&$t(e.entries.get(this.entry_config.name),this.entry_config,this.#l)}explain(){return Ct("acTion.entry_includes",[this.entry_config.name,this.#l])}}class Tt extends At{#l;constructor(e,a){super(e),this.#l=a}evaluate(e){return!!super.evaluate(e)&&$t(e.entries.get(this.entry_config.name),this.entry_config,this.#l,{exact:!0})}explain(){return Ct("acTion.entry_matches",[this.entry_config.name,this.#l])}}class Ht extends At{#n;#o;constructor(e,a,t){super(e),this.#n=a,this.#o=t}evaluate(e){if(!super.evaluate(e))return!1;const a=Ya(this.entry_config,e.entries.get(this.entry_config.name));return null!==a&&this.#n(a)}explain(){return this.#o}}const Et=["=",":",">","<","@"];function Dt(e){const a=e.match(/^"((?:[^\\"]|\\"|\\\\)+?)"/);return null===a||void 0===a[1]?null:{enclosed:a[1].replaceAll(String.raw`\"`,'"').replaceAll("\\\\","\\"),remainder:e.slice(a[0].length)}}function Nt(e){return e.startsWith('"')||Et.map(a=>e.includes(a)).some(Boolean)?`"${e.replaceAll("\\","\\\\").replaceAll('"',String.raw`\"`)}"`:e}function Ot(e){return Et.map(a=>e.indexOf(a)).reduce((e,a)=>-1===e?a:-1===a?e:Math.min(e,a))}function zt(e){if(0===e.length)return null;if("!"===e[0]){const a=zt(e.slice(1));return null===a?null:new Mt(a)}if("$"===e[0])return function(e){if(0===e.length)return null;const{entry_name:a,remainder:t}=(()=>{if('"'===e[0]){const a=Dt(e);return null===a?{entry_name:null,remainder:null}:{entry_name:a.enclosed,remainder:a.remainder}}const a=Ot(e);return-1===a?{entry_name:e,remainder:""}:{entry_name:e.slice(0,a),remainder:e.slice(a)}})();if(null===a||null===t)return null;const l=P().entries.find(e=>e.name===a);if(void 0===l)return null;if(0===t.length)return new At(l);if(1===t.length)return null;const n=t.slice(1);if(["=",":"].includes(t[0]))return new("="===t[0]?Pt:Tt)(l,n);if(l.sorting_method===de.Disabled)return null;const o=(()=>{switch(l.sorting_method){case de.AsString:return n;case de.AsDate:return Ja(n);case de.AsNumber:return Fa(n)}})();if(null===o)return null;const r=new Map([["<",{comparator:(e,a)=>e<a,explain_key:"acTion.entry_less_than"}],["@",{comparator:(e,a)=>e===a,explain_key:"acTion.entry_equals"}],[">",{comparator:(e,a)=>e>a,explain_key:"acTion.entry_greater_than"}]]).get(t[0]);return new Ht(l,e=>r.comparator(e,o),Ct(r.explain_key,[l.name,n]))}(e.slice(1));const a=P();return new Ut(e,a.entries)}const qt={style:{"text-align":"center"}},Lt=T({__name:"Main",setup(e){const{t:a}=B.global,t=ie(),l=P(),r=W(),i=H(Ae),s=f(void 0),u=f(void 0),d=f(!1),m=f(!1),g=f(!1),p=se(new Set),v=f(1),_=f(10),y=f(1);function b(){s.value=void 0,u.value=void 0,d.value=!0}function x(e){u.value=e,s.value=l.data.get(e),d.value=!0}function k(){p.clear(),d.value=!1,p.add(u.value)}const w=f(""),V=G([]),S=f(!1),$=c(()=>{if(""===w.value)return!0;if(";;"===w.value)return S.value;return null!==zt(w.value.slice(w.value.startsWith("~")?1:0))});function C(e){e.startsWith("~")?(S.value||(V.push([]),S.value=!0),V.at(-1).push(e.slice(1))):(S.value=!1,V.push(e))}const I=c(()=>{const e=[];S.value&&";;".startsWith(w.value)&&e.push({command:";;",explanation:a("search.end_group"),action:()=>{w.value="",S.value=!1}});const t=w.value.match(/^(~?!?)(.*)$/),n=t[1],o=[n.includes("~")?`(${a("search.in_group")})`:null,n.includes("!")?`(${a("search.inverse")})`:null].filter(e=>null!==e),r=t[2];let i=!1;if("$"===r[0]){const t=(()=>{const e=r.slice(1);if(0===e.length)return["","",""];if('"'===e[0]){let a=null;for(const t of[e,`${e}"`])if(a=Dt(t),null!==a)break;return null===a?null:a.remainder.length>0?[a.enclosed,a.remainder[0],a.remainder.slice(1)]:[a.enclosed,"",""]}{const a=Ot(e);return-1===a?[e,"",""]:[e.slice(0,a),e[a],e.slice(a+1)]}})();if(null!==t){const[r,s,u]=t;if(""===s){const t=l.entries.find(e=>e.name===r);if(void 0!==t){i=!0;for(const{operator:a,explanation:l}of function(e){const a=[{operator:":",explanation:Ct("search.partial_match")},{operator:"=",explanation:Ct("search.exact_match")}];return e.sorting_method===de.Disabled?a:a.concat([{operator:"<",explanation:Ct("search.match_lesser")},{operator:"@",explanation:Ct("search.match_equal")},{operator:">",explanation:Ct("search.match_greater")}])}(t))e.push({command:`${n}$${Nt(r)}${a}`,explanation:o.concat([l]).join(""),action:()=>{w.value=`${n}$${Nt(r)}${a}`}});e.push({command:w.value,explanation:o.concat([a("search.check_existence")]).join(""),action:()=>{C(w.value),w.value=""}})}for(const a of l.entries.filter(e=>e.name.startsWith(r)&&e.name!==r))e.push({command:`${n}$${Nt(a.name)}`,action:()=>{w.value=`${n}$${Nt(a.name)}`}})}else{const a=l.entries.find(e=>e.name===r);if(void 0!==a&&"tag"===a.type&&"="===s){i=!0;const t=at(u,l.tags.get(a.name)??[]).map(({display:e})=>e);for(const l of t){const t=`${n}$${Nt(a.name)}=${l}`;e.push({command:t,action:()=>{w.value=t}})}}}}}return $.value&&r.length>0&&!i&&e.push({command:w.value,explanation:"$"===r[0]?void 0:o.concat([a("search.general_match")]).join(""),action:()=>{C(w.value),w.value=""}}),e});function j(){$.value&&(";;"!==w.value?(C(w.value),w.value=""):S.value=!1)}const M=c(()=>{const e=new jt;for(const a of V)if(Array.isArray(a)){const t=new Bt;for(const e of a)t.add_child(zt(e));e.add_child(t)}else e.add_child(zt(a));return e}),U=se([]),A=c(()=>{const e=(e,a)=>e<a,t=(e,a)=>e>a,l=[{name:a("sorting_by.none")}];for(const n of U)l.push({name:`${n.name} ${a("sorting_by.ascending")}`,details:{entry:n,less_than:e}},{name:`${n.name} ${a("sorting_by.descending")}`,details:{entry:n,less_than:t}});return l}),T=f(A.value[0]),q=c(()=>Array.from(l.data.entries()).filter(([e,a])=>M.value.evaluate(a))),L=c(()=>void 0===T.value.details?null:q.value.map(e=>{const a=e[1].entries.get(T.value.details.entry.name);return void 0===a?{data:e,key:null}:{data:e,key:Ya(T.value.details.entry,a,l.tags.get(T.value.details.entry.name))}})),R=c(()=>null===L.value?null:L.value.toSorted((e,a)=>{if(null===e.key&&null===a.key)return 0;if(null===e.key)return 1;if(null===a.key)return-1;return T.value.details.less_than(e.key,a.key)?-1:1}).map(e=>e.data)),K=G({selected_items:new Set,show_selected_only:!1}),F=c(()=>{const e=void 0===T.value.details?q.value:R.value;return(K.show_selected_only?e.filter(([e])=>K.selected_items.has(e)):e).map(([e,a])=>e)});function J(e){const a=[...F.value];for(const t of a)e.inverse?K.selected_items.has(t)?K.selected_items.delete(t):K.selected_items.add(t):e.selected?K.selected_items.add(t):K.selected_items.delete(t)}function te(){t.replace("/")}return h(()=>{if(void 0!==l.database_)for(const e of l.entries)e.sorting_method!==de.Disabled&&U.push(e);else t.replace("/")}),(e,a)=>{const t=xt,c=Vt,f=it,h=Xa;return D(),Y(X,null,[n(Ha,null,{default:N(()=>[n(Ea,null,{default:N(()=>[Q(Z(z(l).database_?.configurations.global.name??""),1)]),_:1}),z(l).database_modified?(D(),E(Ne,{key:0,icon:"",onClick:a[0]||(a[0]=a=>z(ue)(z(l).save_delta(),e.$t("action.download_delta"),z(i)))},{default:N(()=>[n(Oe,{color:z(l).database_modified_unsaved?"warning":""},{default:N(()=>[...a[20]||(a[20]=[Q("mdi-download-outline",-1)])]),_:1},8,["color"]),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.download_delta")),1)]),_:1})]),_:1})):O("",!0),n(Ne,{icon:"",onClick:a[1]||(a[1]=a=>z(ue)(z(l).save_all(),e.$t("action.download_delta"),z(i)))},{default:N(()=>[n(Oe,{color:z(l).database_modified_unsaved?"warning":""},{default:N(()=>[...a[21]||(a[21]=[Q(" mdi-download-multiple-outline ",-1)])]),_:1},8,["color"]),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.download_full_database")),1)]),_:1})]),_:1}),n(Ne,{icon:"",onClick:b},{default:N(()=>[n(Oe,null,{default:N(()=>[...a[22]||(a[22]=[Q("mdi-plus",-1)])]),_:1}),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("acTion.create",{target:e.$t("terms.new_database_item")})),1)]),_:1})]),_:1}),z(K).selected_items.size>0?(D(),E(Ne,{key:1,icon:"",onClick:a[2]||(a[2]=e=>m.value=!0)},{default:N(()=>[n(Oe,null,{default:N(()=>[...a[23]||(a[23]=[Q("mdi-pencil-box-multiple-outline",-1)])]),_:1}),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.batch_tag_modify")),1)]),_:1})]),_:1})):O("",!0),n(Ne,{icon:"",onClick:a[3]||(a[3]=e=>g.value=!0)},{default:N(()=>[n(Oe,null,{default:N(()=>[...a[24]||(a[24]=[Q("mdi-import",-1)])]),_:1}),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.import")),1)]),_:1})]),_:1}),n(Ne,{icon:"",to:"/Maintenance"},{default:N(()=>[n(Oe,null,{default:N(()=>[...a[25]||(a[25]=[Q("mdi-wrench",-1)])]),_:1}),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.maintenance")),1)]),_:1})]),_:1}),n(Ne,{icon:"",onClick:te},{default:N(()=>[n(Oe,null,{default:N(()=>[...a[26]||(a[26]=[Q("mdi-logout",-1)])]),_:1}),n(Ge,{activator:"parent",location:"bottom"},{default:N(()=>[Q(Z(e.$t("action.lock_database")),1)]),_:1})]),_:1})]),_:1}),n(qa,{items:F.value,"items-per-page":_.value,page:v.value},{header:N(()=>[n(We,{class:"fill-width"},{default:N(()=>[n(Pe,null,{default:N(()=>[n(qe,null,{default:N(()=>[n(wa,{cols:"8"},{default:N(()=>[n(ca,{search:w.value,"onUpdate:search":a[4]||(a[4]=e=>w.value=e),error:!$.value,"hide-no-data":"","item-title":"command",items:I.value,"no-filter":"","prepend-icon":"mdi-magnify",onKeydown:ae(j,["enter"])},{item:N(({item:e})=>[n(fa,{onClick:e.raw.action},{default:N(()=>[n(va,null,{default:N(()=>[Q(Z(e.raw.command),1)]),_:2},1024),void 0!==e.raw.explanation?(D(),E(ka,{key:0},{default:N(()=>[Q(Z(e.raw.explanation),1)]),_:2},1024)):O("",!0)]),_:2},1032,["onClick"])]),_:1},8,["search","error","items"])]),_:1}),n(wa,{cols:"4"},{default:N(()=>[n(xa,{modelValue:T.value,"onUpdate:modelValue":a[5]||(a[5]=e=>T.value=e),"item-title":"name",items:A.value,label:e.$t("hint.sort_by"),"return-object":""},null,8,["modelValue","items","label"])]),_:1}),n(wa,{cols:"4"},{default:N(()=>[F.value.every(e=>z(K).selected_items.has(e))?(D(),E(Ne,{key:0,onClick:a[6]||(a[6]=e=>J({selected:!1}))},{default:N(()=>[Q(Z(e.$t("action.unselect_all")),1)]),_:1})):(D(),E(Ne,{key:1,onClick:a[7]||(a[7]=e=>J({selected:!0}))},{default:N(()=>[Q(Z(e.$t("action.select_all")),1)]),_:1}))]),_:1}),n(wa,{cols:"4"},{default:N(()=>[n(Ne,{onClick:a[8]||(a[8]=e=>J({inverse:!0}))},{default:N(()=>[Q(Z(e.$t("action.inverse_selection")),1)]),_:1})]),_:1}),n(wa,{cols:"4"},{default:N(()=>[n(ce,{modelValue:z(K).show_selected_only,"onUpdate:modelValue":a[9]||(a[9]=e=>z(K).show_selected_only=e),color:"primary","hide-details":"",label:e.$t("action.show_only_selected")},null,8,["modelValue","label"])]),_:1})]),_:1}),n(qe,{align:"center"},{default:N(()=>[(D(!0),Y(X,null,ee(z(V),(e,a)=>(D(),E(wa,{key:`${e.toString()}@${a}`,class:"flex-grow-0"},{default:N(()=>[Array.isArray(e)?(D(),E(ha,{key:0,class:"py-6",closable:"",style:{width:"max-content"},"onClick:close":e=>z(V).splice(a,1)},{default:N(()=>[n(qe,null,{default:N(()=>[(D(!0),Y(X,null,ee(e,(t,l)=>(D(),E(wa,{key:`${t}@${l}`,class:"flex-grow-0"},{default:N(()=>[n(ha,{closable:"","onClick:close":t=>1===e.length?z(V).splice(a,1):e.splice(l,1)},{default:N(()=>[Q(Z(t),1)]),_:2},1032,["onClick:close"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["onClick:close"])):(D(),E(ha,{key:1,closable:"","onClick:close":e=>z(V).splice(a,1)},{default:N(()=>[Q(Z(e),1)]),_:2},1032,["onClick:close"]))]),_:2},1024))),128))]),_:1}),o("h3",qt,Z(e.$t("message.displayed_items",{count:F.value.length})),1)]),_:1})]),_:1})]),default:N(({items:e})=>[n(Pe,{class:"pa-2",fluid:""},{default:N(()=>[n(qe,{justify:"space-around"},{default:N(()=>[(D(!0),Y(X,null,ee(e,e=>(D(),E(wa,{key:e.raw,class:"flex-grow-0",lg:"4",md:"6",sm:"12",style:{"max-width":"480px"},xl:"3",xxl:"2"},{default:N(()=>[n(t,{configuration:z(l).database_?.configurations.entry.entries,data:z(l).data.get(e.raw),"data-id":e.raw,"override-image":null,selection:z(K).selected_items,"update-broadcast":z(p),onRequestModify:x,onSelect:a=>z(K).selected_items.add(e.raw),onUnselect:a=>z(K).selected_items.delete(e.raw)},null,8,["configuration","data","data-id","selection","update-broadcast","onSelect","onUnselect"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),footer:N(({pageCount:t})=>[n(qe,{justify:"space-around"},{default:N(()=>[n(wa,{cols:"8"},{default:N(()=>[n(ma,{modelValue:v.value,"onUpdate:modelValue":a[10]||(a[10]=e=>v.value=e),length:t},null,8,["modelValue","length"])]),_:2},1024),n(wa,{cols:"2"},{default:N(()=>[n(ge,{modelValue:y.value,"onUpdate:modelValue":a[11]||(a[11]=e=>y.value=e),"control-variant":"hidden",label:e.$t("action.goto"),max:t,min:1,onKeydown:a[12]||(a[12]=ae(e=>v.value=y.value,["enter"]))},null,8,["modelValue","label","max"])]),_:2},1024),n(wa,{cols:"2"},{default:N(()=>[n(xa,{modelValue:_.value,"onUpdate:modelValue":a[13]||(a[13]=e=>_.value=e),items:[10,20,40,50,100],label:e.$t("hint.item_per_page")},null,8,["modelValue","label"])]),_:1})]),_:2},1024)]),_:1},8,["items","items-per-page","page"]),n(Le,{modelValue:d.value,"onUpdate:modelValue":a[14]||(a[14]=e=>d.value=e),class:"justify-center","content-class":"py-16 overflow-x-hidden overflow-y-scroll hide-scroll-bar",height:"100%",persistent:!0,"scroll-strategy":"none",width:"85%"},{default:N(()=>[n(c,{data:s.value,"data-id":u.value,onDone:k},null,8,["data","data-id"])]),_:1},8,["modelValue"]),n(Le,{modelValue:m.value,"onUpdate:modelValue":a[16]||(a[16]=e=>m.value=e),class:"justify-center","content-class":"py-16 overflow-x-hidden overflow-y-scroll hide-scroll-bar",height:"100%",persistent:!0,"scroll-strategy":"none",width:"85%"},{default:N(()=>[n(f,{"item-ids":[...z(K).selected_items.keys()],onClose:a[15]||(a[15]=e=>m.value=!1)},null,8,["item-ids"])]),_:1},8,["modelValue"]),n(Ne,{color:"primary",icon:"mdi-rocket-outline",style:{position:"fixed",right:"24px",bottom:"48px"},onClick:a[17]||(a[17]=e=>z(r)(0))}),n(Ia,{modelValue:g.value,"onUpdate:modelValue":a[19]||(a[19]=e=>g.value=e)},{default:N(()=>[n(h,{onDone:a[18]||(a[18]=e=>g.value=!1)})]),_:1},8,["modelValue"])],64)}}});export{Lt as default};
