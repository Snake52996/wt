import{y as e,z as t,H as l,I as n,h as a,J as i,B as r}from"./VSelect-LIMe1IgN.js";import{p as o,c as u,g as s,as as c,M as p,aM as d,bb as f,r as v,t as m,s as y,O as h,d as g,b1 as b,e as k,x as w,F as S,Q as B,f as I,T as D,au as z}from"./index-X2pssZTS.js";import{z as C}from"./ssrBoot-BJN1Wy2u.js";function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((l,n)=>{if(e.isFile){e.file(e=>l([{file:e,path:t}]),n)}else if(e.isDirectory){e.createReader().readEntries(async e=>{const n=[];for(const l of e)n.push(...await j(l,A(t,l)));l(n)})}})}function A(e,t){return t.isDirectory?`${e}/${t.name}`:e}const T=o({filterByType:String},"file-accept");const V=o({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>"boolean"==typeof e||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...r({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>d(e).every(e=>null!=e&&"object"==typeof e)},...T(),...i({clearable:!0})},"VFileInput"),$=s()({name:"VFileInput",inheritAttrs:!1,props:V(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(i,r){let{attrs:o,emit:s,slots:T}=r;const{t:V}=c(),{filterAccepted:$}=function(e){const t=u(()=>e.filterByType?function(e){const t=e.split(",").map(e=>e.trim().toLowerCase()),l=t.filter(e=>e.startsWith(".")),n=t.filter(e=>e.endsWith("/*")),a=t.filter(e=>!l.includes(e)&&!n.includes(e));return e=>{const t=e.name.split(".").at(-1)?.toLowerCase()??"",i=e.type.split("/").at(0)?.toLowerCase()??"";return a.includes(e.type)||l.includes(`.${t}`)||n.includes(`${i}/*`)}}(e.filterByType):null);return{filterAccepted:function(e){if(t.value){const l=e.filter(t.value);return{accepted:l,rejected:e.filter(e=>!l.includes(e))}}return{accepted:e,rejected:[]}}}}(i),F=p(i,"modelValue",i.modelValue,e=>d(e),e=>!i.multiple&&Array.isArray(e)?e[0]:e),{isFocused:P,focus:E,blur:L}=e(i),N=u(()=>"boolean"!=typeof i.showSize?i.showSize:void 0),x=u(()=>(F.value??[]).reduce((e,t)=>{let{size:l=0}=t;return e+l},0)),M=u(()=>f(x.value,N.value)),O=u(()=>(F.value??[]).map(e=>{const{name:t="",size:l=0}=e,n=function(e){if(e.length<Number(i.truncateLength))return e;const t=Math.floor((Number(i.truncateLength)-1)/2);return`${e.slice(0,t)}â€¦${e.slice(e.length-t)}`}(t);return i.showSize?`${n} (${f(l,N.value)})`:n})),R=u(()=>{const e=F.value?.length??0;return i.showSize?V(i.counterSizeString,e,M.value):V(i.counterString,e)}),G=v(),W=v(),H=v(),J=m(()=>P.value||i.active),Q=u(()=>["plain","underlined"].includes(i.variant)),q=y(!1),{handleDrop:K,hasFilesOrFolders:U}={handleDrop:async function(e){const t=[],l=[...e.dataTransfer?.items??[]].filter(e=>"file"===e.kind).map(e=>e.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const n of l){const e=await j(n,A(".",n));t.push(...e.map(e=>e.file))}else t.push(...e.dataTransfer?.files??[]);return t},hasFilesOrFolders:function(e){return[...e.dataTransfer?.items??[]].filter(e=>"file"===e.kind).map(e=>e.webkitGetAsEntry()).filter(Boolean).length>0||[...e.dataTransfer?.files??[]].length>0}};function X(){H.value!==document.activeElement&&H.value?.focus(),P.value||E()}function Y(e){H.value?.click()}function Z(e){s("mousedown:control",e)}function _(e){H.value?.click(),s("click:control",e)}function ee(e){e.stopPropagation(),X(),D(()=>{F.value=[],z(i["onClick:clear"],e)})}function te(e){e.preventDefault(),e.stopImmediatePropagation(),q.value=!0}function le(e){e.preventDefault(),q.value=!1}async function ne(e){if(e.preventDefault(),e.stopImmediatePropagation(),q.value=!1,!H.value||!U(e))return;ie(await K(e))}function ae(e){if(e.target&&!e.repack)if(i.filterByType)ie([...e.target.files]);else{const t=e.target;F.value=[...t.files??[]]}}function ie(e){const t=new DataTransfer,{accepted:l,rejected:n}=$(e);n.length&&s("rejected",n);for(const i of l)t.items.add(i);H.value.files=t.files,F.value=[...t.files];const a=new Event("change",{bubbles:!0});a.repack=!0,H.value.dispatchEvent(a)}return h(F,e=>{(!Array.isArray(e)||!e.length)&&H.value&&(H.value.value="")}),g(()=>{const e=!(!T.counter&&!i.counter),r=!(!e&&!T.details),[u,s]=b(o),{modelValue:c,...p}=t.filterProps(i),d={...l.filterProps(i),"onClick:clear":ee},f=void 0!==o.webkitdirectory&&!1!==o.webkitdirectory,v=o.accept?String(o.accept):void 0,m=f?void 0:i.filterByType??v;return k(t,B({ref:G,modelValue:i.multiple?F.value:F.value[0],class:["v-file-input",{"v-file-input--chips":!!i.chips,"v-file-input--dragging":q.value,"v-file-input--hide":i.hideInput,"v-input--plain-underlined":Q.value},i.class],style:i.style,"onClick:prepend":Y},u,p,{centerAffix:!Q.value,focused:P.value}),{...T,default:e=>{let{id:t,isDisabled:n,isDirty:r,isReadonly:o,isValid:u,hasDetails:c}=e;return k(l,B({ref:W,prependIcon:i.prependIcon,onMousedown:Z,onClick:_,"onClick:prependInner":i["onClick:prependInner"],"onClick:appendInner":i["onClick:appendInner"]},d,{id:t.value,active:J.value||r.value,dirty:r.value||i.dirty,disabled:n.value,focused:P.value,details:c.value,error:!1===u.value,onDragover:te,onDrop:ne}),{...T,default:e=>{let{props:{class:t,...l},controlRef:r}=e;return w(S,null,[w("input",B({ref:e=>H.value=r.value=e,type:"file",accept:m,readonly:o.value,disabled:n.value,multiple:i.multiple,name:i.name,onClick:e=>{e.stopPropagation(),o.value&&e.preventDefault(),X()},onChange:ae,onDragleave:le,onFocus:X,onBlur:L},l,s),null),w("div",{class:I(t)},[!!F.value?.length&&!i.hideInput&&(T.selection?T.selection({fileNames:O.value,totalBytes:x.value,totalBytesReadable:M.value}):i.chips?O.value.map(e=>k(a,{key:e,size:"small",text:e},null)):O.value.join(", "))])])}})},details:r?t=>w(S,null,[T.details?.(t),e&&w(S,null,[w("span",null,null),k(n,{active:!!F.value?.length,value:R.value,disabled:i.disabled},T.counter)])]):void 0})}),C({},G,W,H)}});export{$ as V};
